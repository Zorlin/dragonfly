{# === MODALS === (Moved inside the main x-data div) #}
<div id="status-modal" class="relative z-10" aria-labelledby="modal-title" role="dialog" aria-modal="true" x-show="statusModal" x-cloak>
    <!-- Removed background overlay -->
    <div class="fixed inset-0 z-10 overflow-y-auto" @click="statusModal = false">
        <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
            <div class="relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6" 
                @click.stop>
                <!-- Status modal content (Placeholder/Not Used Currently) -->
                Status Modal Content
            </div>
        </div>
    </div>
</div>

<div id="os-modal" class="relative z-10" aria-labelledby="modal-title" role="dialog" aria-modal="true" x-show="osModal" x-cloak>
    <!-- Removed background overlay -->
    <div class="fixed inset-0 z-10 overflow-y-auto" @click="osModal = false">
        <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
            <div class="relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6" 
                @click.stop>
                <!-- OS modal content (Placeholder/Not Used Currently) -->
                OS Modal Content
            </div>
        </div>
    </div>
</div>

<div id="delete-modal" class="relative z-10" aria-labelledby="modal-title" role="dialog" aria-modal="true" x-show="deleteModal" x-cloak>
    <!-- Removed background overlay -->
    <div class="fixed inset-0 z-10 overflow-y-auto" @click="deleteModal = false">
        <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
            <div class="relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6" 
                @click.stop>
                <!-- Delete modal content (Generated by showDeleteModal in JS) -->
                <div class="sm:flex sm:items-start">
                    <div class="mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
                        <svg class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                        </svg>
                    </div>
                    <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left">
                        <h3 class="text-base font-semibold leading-6 text-gray-900 dark:text-white" id="modal-title">Delete Machine</h3>
                        <div class="mt-2">
                            <p class="text-sm text-gray-500 dark:text-gray-300">
                                Are you sure you want to delete machine <code x-text="currentMachineId"></code>? This action cannot be undone.
                            </p>
                        </div>
                    </div>
                </div>
                <div class="mt-5 sm:mt-4 sm:flex sm:flex-row-reverse">
                    <button type="button" class="inline-flex w-full justify-center rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 sm:ml-3 sm:w-auto" @click="deleteMachine(currentMachineId)">Delete</button>
                    <button type="button" class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto dark:bg-gray-600 dark:text-white dark:ring-gray-500 dark:hover:bg-gray-500" @click="deleteModal = false">Cancel</button>
                </div>
            </div>
        </div>
    </div>
</div>

{# Tag Editor Modal #}
<div id="tag-modal" class="relative z-20" aria-labelledby="tag-modal-title" role="dialog" aria-modal="true" x-show="tagModal" x-cloak>
    <!-- Removed background overlay -->
    <div class="fixed inset-0 z-20 overflow-y-auto" @click="$dispatch('close-tag-modal')">
        <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
            <div class="relative transform overflow-hidden rounded-lg bg-white dark:bg-gray-800 px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6" 
                @click.stop x-data="tagEditorData()" x-init="if (tagModal) loadTags(currentMachineId)" x-show="tagModal">
                <h3 class="text-lg font-medium leading-6 text-gray-900 dark:text-white mb-1" id="tag-modal-title">
                    Edit Tags for <code class="text-purple-600 dark:text-purple-400" x-text="currentMachineName"></code>
                </h3>
                <p class="text-xs text-gray-500 dark:text-gray-400 mb-4">Machine ID: <code class="text-xs" x-text="currentMachineId"></code></p>

                {# Loading State #}
                <template x-if="isLoading">
                    <div class="text-center p-4">
                        <span class="text-gray-500 dark:text-gray-400">Loading tags...</span>
                    </div>
                </template>

                {# Error Message #}
                <template x-if="errorMessage">
                    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
                        <strong class="font-bold">Error:</strong>
                        <span class="block sm:inline" x-text="errorMessage"></span>
                    </div>
                </template>

                {# Tag Editor Content #}
                <template x-if="!isLoading">
                    <div>
                        {# Display existing tags #}
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Current Tags:</label>
                            <div class="mt-1 flex flex-wrap gap-2" x-show="tags.length > 0">
                                <template x-for="(tag, index) in tags" :key="index">
                                    <span class="inline-flex items-center rounded-full bg-purple-100 dark:bg-purple-900 py-0.5 pl-2.5 pr-1 text-sm font-medium text-purple-700 dark:text-purple-200">
                                        <span x-text="tag"></span>
                                        <button @click="removeTag(index)" type="button" class="ml-0.5 inline-flex h-4 w-4 flex-shrink-0 items-center justify-center rounded-full text-purple-400 hover:bg-purple-200 hover:text-purple-500 focus:bg-purple-500 focus:text-white focus:outline-none">
                                            <span class="sr-only">Remove tag</span>
                                            <svg class="h-2 w-2" stroke="currentColor" fill="none" viewBox="0 0 8 8">
                                                <path stroke-linecap="round" stroke-width="1.5" d="M1 1l6 6m0-6L1 7" />
                                            </svg>
                                        </button>
                                    </span>
                                </template>
                            </div>
                            <p x-show="tags.length === 0" class="mt-1 text-sm text-gray-500 dark:text-gray-400 italic">No tags assigned.</p>
                        </div>

                        {# Add New Tag Input #}
                        <div class="mb-4">
                            <label for="new-tag-input" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Add New Tag:</label>
                            <div class="mt-1 flex rounded-md shadow-sm">
                                <input type="text" id="new-tag-input" x-model="newTag" @keydown.enter.prevent="addTag()" @keydown.space.prevent="addTag()" placeholder="Enter tag name" class="block w-full flex-1 rounded-none rounded-l-md border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <button @click="addTag()" type="button" class="relative -ml-px inline-flex items-center space-x-2 rounded-r-md border border-gray-300 bg-gray-50 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500 dark:bg-gray-600 dark:border-gray-600 dark:text-gray-200 dark:hover:bg-gray-500">
                                    <span>Add</span>
                                </button>
                            </div>
                            <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Press Enter or Space to add the tag.</p>
                        </div>
                    </div>
                </template>

                {# Modal Buttons #}
                <div class="mt-5 sm:mt-6 sm:grid sm:grid-flow-row-dense sm:grid-cols-2 sm:gap-3">
                    <button 
                        type="button" 
                        class="inline-flex w-full justify-center rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:col-start-2 sm:text-sm disabled:opacity-50"
                        @click="saveTags()" 
                        :disabled="isLoading"
                    >
                        Save Tags
                    </button>
                    <button 
                        type="button" 
                        class="mt-3 inline-flex w-full justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-base font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:col-start-1 sm:mt-0 sm:text-sm dark:bg-gray-600 dark:text-white dark:border-gray-500 dark:hover:bg-gray-500"
                        @click="$dispatch('close-tag-modal')"
                    >
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

{# Reimage Modal #}
<div id="reimage-modal" class="relative z-10" aria-labelledby="modal-title" role="dialog" aria-modal="true" x-show="reimageModal" x-cloak>
    <!-- Removed background overlay -->
    <div class="fixed inset-0 z-10 overflow-y-auto" @click="reimageModal = false">
        <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
            <div class="relative transform overflow-hidden rounded-lg bg-white dark:bg-gray-800 px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6" 
                @click.stop>
                <div class="sm:flex sm:items-start">
                    <div class="mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-cyan-100 sm:mx-0 sm:h-10 sm:w-10">
                        <svg class="h-6 w-6 text-cyan-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 12c0-1.232-.046-2.453-.138-3.662a4.006 4.006 0 0 0-3.7-3.7 48.678 48.678 0 0 0-7.324 0 4.006 4.006 0 0 0-3.7 3.7c-.092 1.21-.138 2.43-.138 3.662v.012c0 1.232.046 2.453.138 3.662a4.006 4.006 0 0 0 3.7 3.7 48.656 48.656 0 0 0 7.324 0 4.006 4.006 0 0 0 3.7-3.7c.092-1.21.138-2.43.138-3.662v-.012Zm-7 0a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Z" />
                        </svg>
                    </div>
                    <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left">
                        <h3 class="text-base font-semibold leading-6 text-gray-900 dark:text-white" id="modal-title">Reimage Machine</h3>
                        <div class="mt-2">
                            <p class="text-sm text-gray-500 dark:text-gray-300">Select an OS to reimage machine <code x-text="currentMachineId"></code> with. (Not Implemented)</p>
                            {# TODO: Add OS selection dropdown/buttons and trigger reimage API call #}
                        </div>
                    </div>
                </div>
                <div class="mt-5 sm:mt-4 sm:flex sm:flex-row-reverse">
                    <button type="button" class="disabled:opacity-50 inline-flex w-full justify-center rounded-md bg-cyan-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-cyan-500 sm:ml-3 sm:w-auto" disabled>Reimage</button>
                    <button type="button" @click="reimageModal = false" class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto dark:bg-gray-600 dark:text-white dark:ring-gray-500 dark:hover:bg-gray-500">Cancel</button>
                </div>
            </div>
        </div>
    </div>
</div>

{# Power Modal #}
<div id="power-modal" class="relative z-10" aria-labelledby="modal-title" role="dialog" aria-modal="true" x-show="powerModal" x-cloak>
    <!-- Removed background overlay -->
    <div class="fixed inset-0 z-10 overflow-y-auto" @click="powerModal = false">
        <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
            <div class="relative transform overflow-hidden rounded-lg bg-white dark:bg-gray-800 px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6" 
                @click.stop>
                 <div class="sm:flex sm:items-start">
                    <div class="mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
                        <svg class="h-6 w-6 text-red-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                           <path stroke-linecap="round" stroke-linejoin="round" d="M5.636 5.636a9 9 0 1 0 12.728 0M12 3v9" />
                        </svg>
                    </div>
                    <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left">
                        <h3 class="text-base font-semibold leading-6 text-gray-900 dark:text-white" id="modal-title">Power Control</h3>
                        <div class="mt-2">
                            <p class="text-sm text-gray-500 dark:text-gray-300">Control power for machine <code x-text="currentMachineId"></code>. (Not Implemented)</p>
                            {# TODO: Add buttons for Power On, Power Off, Reboot using BMC API #}
                        </div>
                    </div>
                </div>
                <div class="mt-5 sm:mt-4 sm:flex sm:flex-row-reverse space-x-reverse space-x-2">
                    <button type="button" @click="powerModal = false" class="inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto dark:bg-gray-600 dark:text-white dark:ring-gray-500 dark:hover:bg-gray-500">Cancel</button>
                    <button type="button" class="disabled:opacity-50 inline-flex w-full justify-center rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 sm:w-auto" disabled>Power Off</button>
                    <button type="button" class="disabled:opacity-50 inline-flex w-full justify-center rounded-md bg-green-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-500 sm:w-auto" disabled>Power On</button>
                 </div>
            </div>
        </div>
    </div>
</div>

{# MAC Address Change Confirmation Modal #}
<div id="mac-confirm-modal" class="relative z-50" aria-labelledby="modal-title" role="dialog" aria-modal="true" 
    x-show="macConfirmModal" 
    x-transition:enter="ease-out duration-200"
    x-transition:enter-start="opacity-0 scale-95"
    x-transition:enter-end="opacity-100 scale-100"
    x-transition:leave="ease-in duration-100"
    x-transition:leave-start="opacity-100 scale-100"
    x-transition:leave-end="opacity-0 scale-95"
    x-cloak>
    <!-- Removed background overlay -->
    <div class="fixed inset-0 z-50 overflow-y-auto" @click="macConfirmModal = false">
        <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
            <div class="relative transform overflow-hidden rounded-lg bg-white dark:bg-gray-800 px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6 border border-purple-500/30 dark:border-purple-500/20" 
                @click.stop>
                <div class="sm:flex sm:items-start">
                    <div class="mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-yellow-100 sm:mx-0 sm:h-10 sm:w-10">
                        <svg class="h-6 w-6 text-yellow-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                        </svg>
                    </div>
                    <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left">
                        <h3 class="text-base font-semibold leading-6 text-gray-900 dark:text-white" id="modal-title">Confirm MAC Address Change</h3>
                        <div class="mt-2">
                            <p class="text-sm text-gray-500 dark:text-gray-300">
                                Changing the MAC address for this machine will cause issues if the machine is still using the old one. Are you sure you want to change it to <code x-text="newMacAddress" class="font-mono text-purple-600 dark:text-purple-400"></code>?
                            </p>
                        </div>
                    </div>
                </div>
                <div class="mt-5 sm:mt-4 sm:flex sm:flex-row-reverse">
                    <button type="button" class="inline-flex w-full justify-center rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 sm:ml-3 sm:w-auto" @click="confirmMacChangeApply()">Confirm Change</button>
                    <button type="button" class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto dark:bg-gray-600 dark:text-white dark:ring-gray-500 dark:hover:bg-gray-500" @click="cancelMacChange()">Cancel</button>
                </div>
            </div>
        </div>
    </div>
</div>

{# Add Machine Modal #}
<div id="add-machine-modal" class="relative z-10" aria-labelledby="modal-title" role="dialog" aria-modal="true" x-show="addMachineModal" x-cloak>
    <!-- Remove the background overlay div -->
    <div class="fixed inset-0 z-10 overflow-y-auto" @click="addMachineModal = false">
        <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
            <div class="relative transform overflow-hidden rounded-lg bg-white dark:bg-gray-800 px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-4xl sm:p-6" 
                @click.stop>
                
                <div class="mb-6 text-center">
                    <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">Add Machine</h3>
                    <p class="text-gray-600 dark:text-gray-400">Select how you want to add a new machine to Dragonfly</p>
                </div>
                
                <!-- Three card options similar to welcome.html -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- PXE Boot Machine -->
                    <div @click="addMachineModal = false; addPxeModal = true" 
                        class="bg-emerald-800 dark:bg-emerald-900/90 rounded-xl shadow-md overflow-hidden border border-emerald-700 dark:border-emerald-800 transition-all hover:shadow-lg hover:scale-[1.02] duration-300 flex flex-col cursor-pointer" 
                        style="height: 14em;">
                        <div class="p-4 flex-grow">
                            <div class="flex justify-center items-center mb-4">
                                <div class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-emerald-700 dark:bg-emerald-800">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-emerald-300 dark:text-emerald-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01" />
                                    </svg>
                                </div>
                            </div>
                            <h3 class="text-xl font-semibold text-white mb-3 text-center">Managed</h3>
                            <p class="text-emerald-100 dark:text-emerald-200 mt-2 text-center text-sm">
                                Dragonfly will be allowed to adopt and manage this machine. Great for existing servers.
                            </p>
                        </div>
                    </div>
                    
                    <!-- External Machine -->
                    <div @click="addMachineModal = false; externalMachineModal = true" 
                        class="bg-purple-900 dark:bg-purple-950/90 rounded-xl shadow-md overflow-hidden border border-purple-800 dark:border-purple-800 transition-all hover:shadow-lg hover:scale-[1.02] duration-300 flex flex-col cursor-pointer" 
                        style="height: 14em;">
                        <div class="p-4 flex-grow">
                            <div class="flex justify-center items-center mb-4">
                                <div class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-purple-800 dark:bg-purple-800">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-purple-300 dark:text-purple-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                                    </svg>
                                </div>
                            </div>
                            <h3 class="text-center text-xl font-semibold text-white mb-2">Protected</h3>
                            <p class="text-center text-purple-100 dark:text-purple-200 mt-2 text-sm">
                                Track a machine in Dragonfly, but don't allow reimaging or power control.
                            </p>
                        </div>
                    </div>
                    
                    <!-- Cloud Machine -->
                    <div @click="addMachineModal = false; cloudMachineModal = true" 
                        class="bg-cyan-800 dark:bg-cyan-900/90 rounded-xl shadow-md overflow-hidden border border-cyan-700 dark:border-cyan-800 transition-all hover:shadow-lg hover:scale-[1.02] duration-300 flex flex-col cursor-pointer" 
                        style="height: 14em;">
                        <div class="p-4 flex-grow">
                            <div class="flex justify-center items-center mb-4">
                                <div class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-cyan-700 dark:bg-cyan-700">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-cyan-300 dark:text-cyan-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                    </svg>
                                </div>
                            </div>
                            <h3 class="text-center text-xl font-semibold text-white mb-2">Cloud</h3>
                            <p class="text-center text-cyan-100 dark:text-cyan-200 mt-2 text-sm">
                                Add a machine from a cloud provider
                            </p>
                        </div>
                    </div>
                <!-- Proxmox -->
                <div @click="addMachineModal = false; proxmoxMachineModal = true" 
                    class="rounded-xl shadow-md overflow-hidden border border-[#D96400]/50 dark:border-[#D96400]/30 transition-all hover:shadow-lg hover:scale-[1.02] duration-300 flex flex-col cursor-pointer" 
                    style="height: 14em; background-color: #D96400;"> {# Use inline style for specific hex color #}
                    <div class="p-4 flex-grow">
                        <div class="flex justify-center items-center mb-4">
                            <div class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-white dark:bg-black"> {# Reverted size to w-12 h-12 #}
                                {# Light mode logo #}
                                <img src="/static/logos/proxmox/proxmox-logo-stacked-color.svg" alt="Proxmox Logo" class="h-11 w-11 dark:hidden"> {# Reverted logo size to h-8 w-8 #}
                                {# Dark mode logo #}
                                <img src="/static/logos/proxmox/proxmox-logo-stacked-inverted-color.svg" alt="Proxmox Logo" class="h-11 w-11 hidden dark:block"> {# Reverted logo size to h-8 w-8 #}
                            </div>
                        </div>
                        <h3 class="text-center text-xl font-semibold text-white mb-2">Proxmox</h3>
                        <p class="text-center text-white dark:text-white mt-2 text-sm"> {# Adjusted text color for contrast #}
                            Add a Proxmox machine or cluster
                        </p>
                    </div>
                </div>

                <!-- Temporary -->
                <div @click="addMachineModal = false; temporaryNodeModal = true" 
                    class="rounded-xl shadow-md overflow-hidden border border-gray-300 dark:border-gray-600 transition-all hover:shadow-lg hover:scale-[1.02] duration-300 flex flex-col cursor-pointer" 
                    style="height: 14em; background-color: #930006;">
                    <div class="p-4 flex-grow">
                        <div class="flex justify-center items-center mb-4">
                            <div class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-white dark:bg-black">
                                🧪
                            </div>
                        </div>
                        <h3 class="text-center text-xl font-semibold text-white dark:text-red- mb-2">Temporary</h3>
                        <p class="text-center text-white dark:text-white mt-2 text-sm">
                            Add a temporary machine for testing or development. Can be set to expire.
                        </p>
                    </div>
                </div>

                <!-- Discover -->
                <div @click="addMachineModal = false; discoverMachineModal = true" 
                    class="rounded-xl shadow-md overflow-hidden border border-gray-300 dark:border-gray-600 transition-all hover:shadow-lg hover:scale-[1.02] duration-300 flex flex-col cursor-pointer dark:bg-blue-800" 
                    style="height: 14em">
                    <div class="p-4 flex-grow">
                        <div class="flex justify-center items-center mb-4">
                            <div class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-gray-200 dark:bg-blue-300">
                                🔍
                            </div>
                        </div>
                        <h3 class="text-center text-xl font-semibold text-gray-900 dark:text-white mb-2">Discover</h3>
                        <p class="text-center text-gray-600 dark:text-white mt-2 text-sm">
                            Discover machines on your network.
                        </p>
                    </div>
                </div>
                <!-- Cancel button -->
                <div class="mt-6 text-center">
                    <button type="button" @click="addMachineModal = false"
                            class="inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-4 py-2 text-base font-medium text-gray-700 dark:text-gray-200 shadow-sm hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 sm:text-sm">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

{# PXE Boot Machine Modal #}
<div id="add-pxe-modal" class="relative z-10" aria-labelledby="modal-title" role="dialog" aria-modal="true" x-show="addPxeModal" x-cloak>
    <!-- Removed background overlay -->
    <div class="fixed inset-0 z-10 overflow-y-auto" @click="addPxeModal = false">
        <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
            <div class="relative transform overflow-hidden rounded-lg bg-white dark:bg-gray-800 px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6" 
                @click.stop x-data="addMachineForm()" x-init="initForm()">
                <div>
                    <div class="mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-emerald-100 dark:bg-emerald-900">
                        <svg class="h-6 w-6 text-emerald-600 dark:text-emerald-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01" />
                        </svg>
                    </div>
                    <div class="mt-3 text-center sm:mt-5">
                        <h3 class="text-lg font-medium leading-6 text-gray-900 dark:text-white" id="modal-title">Connect a Machine</h3>
                        <div class="mt-2">
                            <p class="text-sm text-gray-500 dark:text-gray-400">
                                Add a machine that will be provisioned via PXE boot by providing its MAC address. You can optionally set a hostname and IP address.
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Form fields -->
                <div class="mt-5 sm:mt-6">
                    <form @submit.prevent="submitForm">
                        <div class="space-y-4">
                            <!-- MAC Address (required) -->
                            <div>
                                <label for="mac-address" class="block text-sm font-medium text-gray-700 dark:text-gray-300">MAC Address <span class="text-red-500">*</span></label>
                                <div class="mt-1">
                                    <input type="text" name="mac_address" id="mac-address" 
                                           x-model="formData.mac_address" 
                                           class="block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-emerald-500 focus:ring-emerald-500 sm:text-sm"
                                           placeholder="e.g., 00:11:22:33:44:55" required>
                                </div>
                                <p class="mt-1 text-xs text-red-500" x-show="errors.mac_address" x-text="errors.mac_address"></p>
                            </div>
                            
                            <!-- Hostname (optional) -->
                            <div>
                                <label for="hostname" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Hostname</label>
                                <div class="mt-1">
                                    <input type="text" name="hostname" id="hostname" 
                                           x-model="formData.hostname" 
                                           class="block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-emerald-500 focus:ring-emerald-500 sm:text-sm"
                                           placeholder="e.g., server01">
                                </div>
                                <p class="mt-1 text-xs text-red-500" x-show="errors.hostname" x-text="errors.hostname"></p>
                            </div>
                            
                            <!-- IP Address (optional) -->
                            <div>
                                <label for="ip-address" class="block text-sm font-medium text-gray-700 dark:text-gray-300">IP Address</label>
                                <div class="mt-1">
                                    <input type="text" name="ip_address" id="ip-address" 
                                           x-model="formData.ip_address" 
                                           class="block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-emerald-500 focus:ring-emerald-500 sm:text-sm"
                                           placeholder="e.g., 192.168.1.100">
                                </div>
                                <p class="mt-1 text-xs text-red-500" x-show="errors.ip_address" x-text="errors.ip_address"></p>
                            </div>
                            
                            <!-- Initial Status -->
                            <div>
                                <label for="status" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Initial Status</label>
                                <div class="mt-1">
                                    <select id="status" name="status" x-model="formData.status" 
                                            class="block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-emerald-500 focus:ring-emerald-500 sm:text-sm">
                                        <option value="AwaitingAssignment">Awaiting OS Assignment</option>
                                        <option value="ExistingOS">Existing OS</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Optional Descriptive Name -->
                            <div>
                                <label for="memorable-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Descriptive Name</label>
                                <div class="mt-1">
                                    <input type="text" name="memorable_name" id="memorable-name" 
                                           x-model="formData.memorable_name" 
                                           class="block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-emerald-500 focus:ring-emerald-500 sm:text-sm"
                                           placeholder="e.g., Web Server">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Error message -->
                        <div class="mt-4" x-show="formError">
                            <p class="text-sm text-red-600 dark:text-red-400" x-text="formError"></p>
                        </div>
                        
                        <!-- Form buttons -->
                        <div class="mt-5 sm:mt-6 sm:grid sm:grid-flow-row-dense sm:grid-cols-2 sm:gap-3">
                            <button type="submit" 
                                    class="inline-flex w-full justify-center rounded-md border border-transparent bg-emerald-600 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 sm:col-start-2 sm:text-sm"
                                    :disabled="isSubmitting">
                                <span x-show="!isSubmitting">Add PXE Machine</span>
                                <span x-show="isSubmitting" class="flex items-center">
                                    <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                    </svg>
                                    Processing...
                                </span>
                            </button>
                            <button type="button" @click="addPxeModal = false"
                                    class="mt-3 inline-flex w-full justify-center rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-4 py-2 text-base font-medium text-gray-700 dark:text-gray-200 shadow-sm hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 sm:col-start-1 sm:mt-0 sm:text-sm">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

{# External Machine Modal #}
<div id="external-machine-modal" class="relative z-10" aria-labelledby="modal-title" role="dialog" aria-modal="true" x-show="externalMachineModal" x-cloak>
    <!-- Removed background overlay -->
    <div class="fixed inset-0 z-10 overflow-y-auto" @click="externalMachineModal = false">
        <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
            <div class="relative transform overflow-hidden rounded-lg bg-white dark:bg-gray-800 px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6" 
                @click.stop>
                <div>
                    <div class="mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-purple-100 dark:bg-purple-900">
                        <svg class="h-6 w-6 text-purple-600 dark:text-purple-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                        </svg>
                    </div>
                    <div class="mt-3 text-center sm:mt-5">
                        <h3 class="text-lg font-medium leading-6 text-gray-900 dark:text-white" id="modal-title">Add External Machine</h3>
                        <div class="mt-2">
                            <p class="text-sm text-gray-500 dark:text-gray-400">
                                Add an existing machine that will not be provisioned by Dragonfly.
                            </p>
                            <p class="text-sm text-gray-500 dark:text-gray-400 mt-4">
                                This feature is coming soon.
                            </p>
                        </div>
                    </div>
                </div>
                
                <div class="mt-5 sm:mt-6">
                    <button type="button" @click="externalMachineModal = false"
                            class="inline-flex w-full justify-center rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-4 py-2 text-base font-medium text-gray-700 dark:text-gray-200 shadow-sm hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 sm:text-sm">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

{# BMC Machine Modal #}
<div id="bmc-machine-modal" class="relative z-10" aria-labelledby="modal-title" role="dialog" aria-modal="true" x-show="bmcMachineModal" x-cloak>
    <!-- Removed background overlay -->
    <div class="fixed inset-0 z-10 overflow-y-auto" @click="bmcMachineModal = false">
        <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
            <div class="relative transform overflow-hidden rounded-lg bg-white dark:bg-gray-800 px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6" 
                @click.stop>
                <div>
                    <div class="mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-cyan-100 dark:bg-cyan-900">
                        <svg class="h-6 w-6 text-cyan-600 dark:text-cyan-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                    </div>
                    <div class="mt-3 text-center sm:mt-5">
                        <h3 class="text-lg font-medium leading-6 text-gray-900 dark:text-white" id="modal-title">Add BMC Managed Machine</h3>
                        <div class="mt-2">
                            <p class="text-sm text-gray-500 dark:text-gray-400">
                                Add a machine with BMC (IPMI, Redfish, iDRAC) for power control and management.
                            </p>
                            <p class="text-sm text-gray-500 dark:text-gray-400 mt-4">
                                This feature is coming soon.
                            </p>
                        </div>
                    </div>
                </div>
                
                <div class="mt-5 sm:mt-6">
                    <button type="button" @click="bmcMachineModal = false"
                            class="inline-flex w-full justify-center rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-4 py-2 text-base font-medium text-gray-700 dark:text-gray-200 shadow-sm hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:ring-offset-2 sm:text-sm">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>